<!-- templates/dashboard.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de An√°lisis VR</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Estilos externos optimizados -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner-container">
            <div class="spinner"></div>
            <div class="spinner-text">Cargando datos...</div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Confirmation Modal -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-modal-content">
            <div class="confirm-modal-header">
                <div class="confirm-modal-icon" id="confirmIcon">‚ö†Ô∏è</div>
                <div class="confirm-modal-title" id="confirmTitle">Confirmaci√≥n</div>
            </div>
            <div class="confirm-modal-message" id="confirmMessage"></div>
            <div class="confirm-modal-buttons">
                <button class="btn-cancel" onclick="hideConfirmModal()">Cancelar</button>
                <button class="btn-confirm" id="confirmButton">Confirmar</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div>
                <h1>üìä Dashboard de An√°lisis VR</h1>
                <p>Bienvenido, {{ profesor.nombre }}</p>
            </div>
            <div class="header-buttons">
                <button class="btn btn-primary" onclick="refreshData()">üîÑ Actualizar Datos</button>
                <button class="btn btn-primary" onclick="verResultadosPorMaqueta()">üìä Ver por Maqueta</button>
                <a style="text-align: center;" href="/dashboard/manual-entry" class="btn btn-secondary">üìù Registro Manual</a>
                <button class="btn btn-logout" onclick="confirmLogout()">üö™ Cerrar Sesi√≥n</button>
            </div>
        </div>

        <div id="loading" class="loading">Cargando datos...</div>

        <div id="content" style="display: none;">
            <!-- Insights Autom√°ticos -->
            <div id="insights-container" style="margin-bottom: 20px;"></div>

            <!-- Estad√≠sticas Generales -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>TOTAL SESIONES</h3>
                    <div class="value" id="total-sesiones">0</div>
                    <div class="label">Total de intentos realizados</div>
                </div>
                <div class="stat-card">
                    <h3>PROMEDIO PUNTAJE</h3>
                    <div class="value" id="promedio-puntaje">0</div>
                    <div class="label">sobre 7.0 puntos</div>
                </div>
                <div class="stat-card">
                    <h3>TASA DE APROBACI√ìN</h3>
                    <div class="value" id="tasa-aprobacion">0%</div>
                    <div class="label">estudiantes con ‚â• 4.0 pts</div>
                </div>
                <div class="stat-card">
                    <h3>TIEMPO PROMEDIO</h3>
                    <div class="value" id="tiempo-promedio">0</div>
                    <div class="label">minutos:segundos</div>
                </div>
                <div class="stat-card">
                    <h3>TOTAL ESTUDIANTES</h3>
                    <div class="value" id="total-estudiantes">0</div>
                    <div class="label">en el sistema</div>
                </div>
                <div class="stat-card">
                    <h3>DESVIACI√ìN EST√ÅNDAR</h3>
                    <div class="value" id="desviacion-puntaje">0</div>
                    <div class="label">variabilidad de puntajes</div>
                </div>
            </div>

            <!-- An√°lisis de Correlaciones y Predicci√≥n -->
            <!--div class="charts-grid">
                <div class="chart-card">
                <h3>üîÆ Modelos Predictivos de Regresi√≥n</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="mostrarRegresionSimple()" style="flex: 1;">
                            üìà Regresi√≥n Simple<br>
                            <small style="font-size: 11px; opacity: 0.9;">Puntaje vs Tiempo VR</small>
                        </button>
                        <button class="btn btn-primary" onclick="mostrarRegresionMultiple()" style="flex: 1;">
                            üìä Regresi√≥n M√∫ltiple<br>
                            <small style="font-size: 11px; opacity: 0.9;">Tiempo + Intentos + Complejidad</small>
                        </button>
                    </div>
                    <div id="prediction-content"></div>
                </div>
            </div-->

            <!-- Gr√°ficos Principales -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Distribuci√≥n de Puntajes</h3>
                    <canvas id="scoresChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Rendimiento por Maqueta</h3>
                    <canvas id="maquetasChart"></canvas>
                </div>
            </div>

            <!-- M√°s Gr√°ficos -->
            <div class="charts-grid">
                <div class="chart-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0;">Relaci√≥n Tiempo vs Puntaje</h3>
                    </div>
                    <canvas id="scatterChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Tendencia Temporal</h3>
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <!-- NUEVOS M√ìDULOS ML PROFESIONALES -->
            <!-- Clasificaci√≥n Binaria -->
            <div class="chart-card" style="margin-bottom: 20px;">
                <h3>ü§ñ Predicci√≥n de Aprobaci√≥n</h3>
                <div id="ml-clasificacion"></div>
            </div>

            <!-- K-Means Profesional -->
            <div class="chart-card" style="margin-bottom: 20px;">
                <h3>üë• Agrupaci√≥n de Estudiantes</h3>
                <div id="ml-clustering"></div>
            </div>

            <!-- Correlaciones con P-Values -->
            <div class="chart-card" style="margin-bottom: 20px;">
                <h3>üî¨ Correlaciones Estad√≠sticas Avanzadas</h3>
                <div id="ml-correlaciones"></div>
                <div id="correlation-content"></div>
            </div>

            <!-- Estudiantes en Riesgo -->
            <div class="students-table">
                <h3>Estudiantes que Requieren Atenci√≥n</h3>
                <table id="risk-table">
                    <thead>
                        <tr>
                            <th>Estudiante</th>
                            <th>Promedio</th>
                            <th>Tiempo Promedio</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody id="risk-tbody"></tbody>
                </table>
            </div>

            <!-- Top Estudiantes -->
            <div class="students-table" style="margin-top: 20px;">
                <h3>Top 10 Estudiantes</h3>
                <table id="ranking-table">
                    <thead>
                        <tr>
                            <th>Posici√≥n</th>
                            <th>Estudiante</th>
                            <th>Promedio</th>
                            <th>Tiempo Promedio</th>
                            <th>Puntuaci√≥n Final</th>
                        </tr>
                    </thead>
                    <tbody id="ranking-tbody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal para ver resultados por maqueta -->
    <div id="maquetaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä Resultados por Maqueta</h2>
                <button class="close-modal" onclick="cerrarModalMaqueta()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="maqueta-selector">
                    <label for="maquetaSelect" style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">
                        Selecciona una Maqueta:
                    </label>
                    <select id="maquetaSelect" onchange="filtrarPorMaqueta()">
                        <option value="">Cargando...</option>
                    </select>
                </div>
                <div class="maqueta-selector" style="margin-top: 15px;">
                    <label for="estudianteFilterInput" style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">
                        üîç Filtrar por Estudiante:
                    </label>
                    <input 
                        type="text" 
                        id="estudianteFilterInput" 
                        placeholder="Escribe el nombre del estudiante..." 
                        oninput="filtrarPorMaqueta()"
                        style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 14px;"
                    >
                </div>
                <div class="maqueta-selector" style="margin-top: 15px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">
                        üìã Clasificaci√≥n por Aprobaci√≥n:
                    </label>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="filtrarPorAprobacion('todos')" id="btnTodos" style="flex: 1; background: #667eea;">
                            üë• Todos
                        </button>
                        <button class="btn btn-secondary" onclick="filtrarPorAprobacion('aprobados')" id="btnAprobados" style="flex: 1;">
                            ‚úÖ Aprobados (‚â•4.0)
                        </button>
                        <button class="btn btn-secondary" onclick="filtrarPorAprobacion('reprobados')" id="btnReprobados" style="flex: 1;">
                            ‚ùå Reprobados (<4.0)
                        </button>
                    </div>
                </div>
                <div id="maquetaResultados">
                    <div class="no-data">Selecciona una maqueta para ver los resultados</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts externos optimizados con cache y lazy loading -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard-charts.js') }}"></script>
</body>
</html>
