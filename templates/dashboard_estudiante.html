<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Dashboard VR - {{ estudiante.nombre }}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard-estudiante.css') }}">
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner-container">
            <div class="spinner"></div>
            <div class="spinner-text">Cargando datos...</div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Confirmation Modal -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-modal-content">
            <div class="confirm-modal-header">
                <div class="confirm-modal-icon" id="confirmIcon">⚠️</div>
                <div class="confirm-modal-title" id="confirmTitle">Confirmación</div>
            </div>
            <div class="confirm-modal-message" id="confirmMessage"></div>
            <div class="confirm-modal-buttons">
                <button class="btn-cancel" onclick="hideConfirmModal()">Cancelar</button>
                <button class="btn-confirm" id="confirmButton">Confirmar</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div>
                <h1>🎓 Mi Dashboard VR</h1>
                <p>Hola, {{ estudiante.nombre }}</p>
            </div>
            <div class="header-buttons">
                <button class="btn btn-primary" onclick="refreshData()">🔄 Actualizar</button>
                <button class="btn btn-primary" onclick="verMisMaquetas()">📊 Ver por Maqueta</button>
                <button class="btn btn-success" onclick="openProfesorModal()">👨‍🏫 Mis Profesores</button>
                <button class="btn btn-logout" onclick="confirmLogout()">🚪 Cerrar Sesión</button>
            </div>
        </div>

        <div id="loading" class="loading">Cargando tus datos...</div>

        <div id="content" style="display: none;">
            <!-- Profesor Actual -->
            <div id="profesorActual" class="profesor-section" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #333;">📚 Profesor Actual</h3>
                <div id="profesorActualCard"></div>
            </div>

            <!-- Filtro por Profesor -->
            <div class="section" id="filtroProfesor" style="display: none;">
                <div class="section-title">🔍 Filtrar por Profesor</div>
                <div style="display: flex; gap: 15px; align-items: center; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <label for="profesorFilter" style="font-weight: 600; color: #333;">Seleccionar Profesor:</label>
                    <select id="profesorFilter" onchange="filtrarPorProfesor()" style="flex: 1; padding: 10px; border: 2px solid #667eea; border-radius: 5px; font-size: 16px;">
                        <option value="">Todos los profesores</option>
                    </select>
                    <button class="btn btn-primary" onclick="limpiarFiltroProfesor()">Limpiar</button>
                </div>
            </div>

            <!-- Estadísticas Generales -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total de Sesiones</div>
                    <div class="stat-value" id="totalSesiones">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Puntaje Promedio</div>
                    <div class="stat-value" id="puntajePromedio">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Mejor Puntaje</div>
                    <div class="stat-value" id="mejorPuntaje">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Tiempo Promedio</div>
                    <div class="stat-value" id="tiempoPromedio">0</div>
                    <div class="stat-label">minutos:segundos</div>
                </div>
            </div>

            <!-- Insights Personalizados -->
            <div class="section">
                <div class="section-title">💡 Insights Personalizados</div>
                <ul id="insightsList" class="insights-list"></ul>
            </div>

            <!-- Gráficos -->
            <div class="grid-2">
                <div class="section">
                    <div class="section-title">📈 Tu Progreso</div>
                    <div class="chart-container">
                        <canvas id="progresoChart"></canvas>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">📊 Puntajes por Maqueta</div>
                    <div class="chart-container">
                        <canvas id="maquetasChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Detalle por Maqueta -->
            <div class="section">
                <div class="section-title">🎮 Análisis por Maqueta</div>
                <div id="maquetasDetalle"></div>
            </div>
        </div>

        <!-- Sin datos -->
        <div id="noData" class="no-data" style="display: none;">
            <h2>👋 ¡Bienvenido!</h2>
            <p>Aún no tienes sesiones registradas.</p>
            <p>Comienza a usar el sistema VR para ver tus estadísticas aquí.</p>
        </div>
    </div>

    <!-- Modal de Profesores -->
    <div id="profesorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>👨‍🏫 Gestión de Profesores</h2>
                <span class="close" onclick="closeProfesorModal()">&times;</span>
            </div>
            <div id="profesorModalContent"></div>
        </div>
    </div>

    <!-- Modal para ver mis maquetas (estudiante) -->
    <div id="maquetaModalEstudiante" class="modal-maqueta">
        <div class="modal-maqueta-content">
            <div class="modal-maqueta-header">
                <h2>📊 Mis Resultados por Maqueta</h2>
                <button class="close-maqueta" onclick="cerrarModalMaquetaEstudiante()">&times;</button>
            </div>
            <div class="modal-maqueta-body">
                <div class="maqueta-selector-est">
                    <label for="maquetaSelectEst" style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">
                        Selecciona una Maqueta:
                    </label>
                    <select id="maquetaSelectEst" onchange="filtrarMisMaquetas()" style="margin-bottom: 15px;">
                        <option value="">Cargando...</option>
                    </select>
                    
                    <label for="profesorSelectModal" style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">
                        Filtrar por Profesor:
                    </label>
                    <select id="profesorSelectModal" onchange="filtrarMisMaquetas()" style="margin-bottom: 15px;">
                        <option value="">Todos los profesores</option>
                    </select>
                </div>
                <div id="maquetaResultadosEst">
                    <div class="no-data">Selecciona una maqueta para ver tus resultados</div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard-estudiante.js') }}"></script>
</body>
</html>
